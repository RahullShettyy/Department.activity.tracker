<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Detailed Event View</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;family=Lora:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#135bec",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101622",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "serif": ["Lora", "serif"]
                    },
                },
            },
        }
    </script>
</head>

<body class="bg-background-light dark:bg-background-dark text-[#0d121b] dark:text-gray-100 min-h-screen">
    <!-- Top Navigation Bar -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-solid border-[#e7ebf3] dark:border-gray-800 px-4 lg:px-20 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between whitespace-nowrap">
            <div class="flex items-center gap-8">
                <h2 class="text-[#0d121b] dark:text-white text-xl font-bold leading-tight tracking-tight cursor-pointer"
                    onclick="window.location.href='index.html'">DeptEventTrack</h2>
                <nav class="hidden md:flex items-center gap-6">
                    <a class="text-[#4c669a] dark:text-gray-400 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors"
                        href="index.html">Dashboard</a>
                    <a class="text-primary text-sm font-semibold border-b-2 border-primary pb-1"
                        href="events.html">Events</a>
                    <a class="text-[#4c669a] dark:text-gray-400 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors"
                        href="calendar.html">Calendar</a>
                    <a class="text-[#4c669a] dark:text-gray-400 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors"
                        href="reports.html">Reports</a>
                </nav>
            </div>
            <!-- User profile etc -->
        </div>
    </header>
    <main class="max-w-7xl mx-auto px-4 lg:px-20 py-6">
        <!-- Breadcrumbs -->
        <div class="flex flex-wrap gap-2 mb-6">
            <a class="text-[#4c669a] dark:text-gray-400 hover:text-primary text-sm font-medium"
                href="index.html">Home</a>
            <span class="text-[#4c669a] dark:text-gray-600 text-sm">/</span>
            <a class="text-[#4c669a] dark:text-gray-400 hover:text-primary text-sm font-medium" href="events.html">All
                Events</a>
            <span class="text-[#4c669a] dark:text-gray-600 text-sm">/</span>
            <span class="text-[#0d121b] dark:text-white text-sm font-semibold">AI Ethics in Modern Research</span>
        </div>

        <!-- Main Split-Pane Content -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <!-- Left Pane: Event Content (65%) -->
            <div class="lg:col-span-8 flex flex-col gap-8">
                <!-- Hero Section -->
                <div class="relative group">
                    <div class="w-full aspect-[21/9] rounded-xl overflow-hidden bg-gray-200 dark:bg-gray-800 shadow-lg">
                        <div class="w-full h-full bg-gray-800 flex items-center justify-center text-white text-3xl font-serif"
                            id="eventHeroImage">
                            Event Image
                        </div>
                    </div>
                    <div class="absolute bottom-0 left-0 p-8">
                        <span
                            class="inline-block px-3 py-1 bg-primary text-white text-xs font-bold uppercase tracking-widest rounded mb-3"
                            id="eventDeptBadge">Department</span>
                        <h1 class="serif-heading text-4xl font-bold text-white leading-tight shadow-black drop-shadow-md"
                            id="eventTitle">Loading...</h1>
                    </div>
                </div>
                <!-- Metadata Row -->
                <div class="flex flex-wrap gap-8 items-center py-4 border-b border-gray-100 dark:border-gray-800">
                    <div class="flex items-center gap-3">
                        <div class="size-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                            <span class="material-symbols-outlined">calendar_today</span>
                        </div>
                        <div>
                            <p class="text-xs text-[#4c669a] dark:text-gray-400 font-semibold uppercase">Date</p>
                            <p class="text-sm font-bold" id="eventDate">--</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="size-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                            <span class="material-symbols-outlined">location_on</span>
                        </div>
                        <div>
                            <p class="text-xs text-[#4c669a] dark:text-gray-400 font-semibold uppercase">Venue</p>
                            <p class="text-sm font-bold" id="eventLocation">--</p>
                        </div>
                    </div>
                </div>
                <!-- About Section -->
                <div>
                    <h3 class="serif-heading text-2xl font-bold mb-4">About the Event</h3>
                    <div class="prose dark:prose-invert max-w-none text-[#4c669a] dark:text-gray-300 leading-relaxed">
                        <p class="mb-4" id="eventDescription">Loading description...</p>
                    </div>
                </div>

                <!-- Admin Actions -->
                <div class="p-6 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700">
                    <h3 class="font-bold text-lg mb-4">Admin Controls</h3>
                    <div class="flex gap-4">
                        <button
                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2"
                            onclick="navigateToAttendance()">
                            <span class="material-symbols-outlined">checklist</span>
                            Track Attendance
                        </button>
                        <button
                            class="bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-2"
                            onclick="window.location.href='event-report.html?id='+eventId">
                            <span class="material-symbols-outlined">bar_chart</span>
                            View Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Right Pane: Wrapper for Tracker -->
        <div class="lg:col-span-4 flex flex-col gap-6">
            <!-- Registration Card -->
            <div
                class="bg-white dark:bg-gray-900 rounded-2xl border border-gray-100 dark:border-gray-800 shadow-xl overflow-hidden sticky top-24">
                <div class="p-6 bg-primary/5 border-b border-gray-100 dark:border-gray-800">
                    <h3 class="serif-heading text-xl font-bold">Secure Your Spot</h3>
                </div>
                <div class="p-6">
                    <!-- Tracker -->
                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-sm font-bold text-[#0d121b] dark:text-gray-200">Seats filled</span>
                            <span class="text-xs font-medium text-[#4c669a] dark:text-gray-400">145 / 200
                                registered</span>
                        </div>
                        <div class="w-full h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full bg-primary" style="width: 72.5%;"></div>
                        </div>
                    </div>
                    <form class="flex flex-col gap-4" id="regForm">
                        <div>
                            <label
                                class="block text-xs font-bold text-[#0d121b] dark:text-gray-300 uppercase mb-1.5">Full
                                Name</label>
                            <input name="studentName"
                                class="w-full rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800 text-sm focus:border-primary focus:ring-primary"
                                placeholder="Jane Doe" required="" type="text" />
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold text-[#0d121b] dark:text-gray-300 uppercase mb-1.5">University
                                ID / Email</label>
                            <input name="studentEmail"
                                class="w-full rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800 text-sm focus:border-primary focus:ring-primary"
                                placeholder="jane.doe@university.edu" required="" type="email" />
                        </div>
                        <div>
                            <label
                                class="block text-xs font-bold text-[#0d121b] dark:text-gray-300 uppercase mb-1.5">Department</label>
                            <select name="department"
                                class="w-full rounded-lg border-gray-300 dark:border-gray-700 dark:bg-gray-800 text-sm focus:border-primary focus:ring-primary">
                                <option>Computer Science</option>
                                <option>Philosophy</option>
                                <option>Engineering</option>
                                <option>External Guest</option>
                            </select>
                        </div>
                        <button
                            class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-3 rounded-lg shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2"
                            type="submit">
                            <span class="material-symbols-outlined">how_to_reg</span>
                            Register Now
                        </button>
                    </form>
                </div>
            </div>
        </div>
        </div>
    </main>
    <script>
        const API_BASE = window.location.port === '8000' ? '' : 'http://localhost:8000';
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        document.addEventListener('DOMContentLoaded', () => {
            if (eventId) {
                fetchEventDetails(eventId);
            } else {
                console.error("No Event ID provided");
                // Optionally redirect or show error
            }

            // Form handling (existing code)
            document.getElementById('regForm').addEventListener('submit', function (e) { /*...*/ });
        });

        function fetchEventDetails(id) {
            // Since we only have /api/events which returns ALL events, we'll fetch all and find one. 
            // In a real app we'd have /api/events/:id

            // Wait, let's just update the API to support /api/events?id=X or handle logic here
            // For simplicity in this mini-project without PathParam parsing in Java raw HttpServer:
            fetch(`${API_BASE}/api/events`)
                .then(r => r.json())
                .then(events => {
                    const event = events.find(e => e.id == id);
                    if (event) {
                        renderEvent(event);
                    } else {
                        document.getElementById('eventTitle').innerText = "Event Not Found";
                    }
                })
                .catch(err => console.error(err));
        }

        function renderEvent(event) {
            document.getElementById('eventTitle').innerText = event.title;
            document.getElementById('eventDate').innerText = new Date(event.eventDate).toLocaleString();
            document.getElementById('eventLocation').innerText = event.location;
            document.getElementById('eventDescription').innerText = event.description;
            document.getElementById('eventDeptBadge').innerText = "Dept " + event.departmentId;
            // Update hero image or other dynamic elements if available
        }

        function navigateToAttendance() {
            window.location.href = `attendance.html?id=${eventId}`;
        }

        document.getElementById('regForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = {
                studentName: formData.get('studentName'),
                studentEmail: formData.get('studentEmail'),
                department: formData.get('department'),
                eventId: eventId
            };

            fetch(`${API_BASE}/api/registrations`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
                .then(r => {
                    if (r.ok) {
                        alert('Registration Successful!');
                        e.target.reset();
                    } else {
                        alert('Registration Failed');
                    }
                })
                .catch(err => console.error(err));
        });
    </script>
</body>

</html>